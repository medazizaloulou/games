<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…ØªØ§Ù‡Ø© Ø§Ù„Ø¹Ù‚Ù„ - Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
<style>
body{
  margin:0;
  font-family:Arial;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
  flex-direction:column;
  background:linear-gradient(-45deg,#0f2027,#203a43,#2c5364,#1c1c3c);
  background-size:400% 400%;
  animation:gradientBG 12s ease infinite;
}
@keyframes gradientBG{
0%{background-position:0% 50%;}
50%{background-position:100% 50%;}
100%{background-position:0% 50%;}
}
#info{
margin-bottom:15px;
font-size:calc(12px + 0.5vw);
text-shadow:0 0 10px cyan;
}
canvas{
background:black;
border-radius:15px;
box-shadow:0 0 40px cyan;
max-width:100%;
height:auto;
}
#gameOver{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.9);
display:none;
justify-content:center;
align-items:center;
flex-direction:column;
z-index:999;
}
#gameOver h1{
color:red;
font-size:50px;
text-shadow:0 0 20px red;
margin-bottom:20px;
}
#gameOver button{
padding: calc(6px + 0.5vw) calc(10px + 1vw);
margin:10px;
font-size: calc(12px + 0.5vw);
cursor:pointer;
border:none;
border-radius:8px;
}
.retry{background:lime;}
.reset{background:orange;}
.popup{
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%);
background:gold;
color:black;
padding:15px;
border-radius:10px;
font-weight:bold;
box-shadow:0 0 20px gold;
z-index:9999;
}
</style>
</head>
<body>

<div id="info">
ğŸ† Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <span id="level">1</span> |
ğŸ¥‡ Ø£ÙØ¶Ù„: <span id="best">1</span> |
â³ Ø§Ù„ÙˆÙ‚Øª: <span id="time">30</span>
</div>

<canvas id="game"></canvas>

<div id="gameOver">
<h1>ğŸ’€ Game Over</h1>
<p id="finalLevel"></p>
<button class="retry" onclick="retry()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
<button class="reset" onclick="resetGame()">Ø§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯</button>
</div>

<div id="controls">
<button onclick="move(0,-1)">â¬†ï¸</button>
<button onclick="move(0,1)">â¬‡ï¸</button>
<button onclick="move(-1,0)">â¬…ï¸</button>
<button onclick="move(1,0)">â¡ï¸</button>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

// Ø§Ù„Ø£ØµÙˆØ§Øª
const transitionSound = new Audio("https://www.soundjay.com/buttons/sounds/button-16.mp3");

let level=parseInt(localStorage.getItem("currentLevel"))||1;
let best=parseInt(localStorage.getItem("bestLevel"))||1;
document.getElementById("level").innerText=level;
document.getElementById("best").innerText=best;

let rows,cols,size,maze,player,exit,timeLeft,timer;

// Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
function saveProgress(){ localStorage.setItem("currentLevel",level); }

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ØªØ§Ù‡Ø© Ø¨Ø´ÙƒÙ„ Ù…ØªÙˆØ§Ø²Ù† Ù„ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©
function generateMaze(){
    const baseRows = 15, baseCols = 15;
    rows = baseRows + Math.floor(level/2);
    cols = baseCols + Math.floor(level/2);
    if(rows % 2===0) rows++;
    if(cols % 2===0) cols++;
    size = Math.min(window.innerWidth, window.innerHeight-100)/cols;

    maze=[];
    for(let y=0;y<rows;y++){ maze[y]=[]; for(let x=0;x<cols;x++) maze[y][x]=1; }

    function carve(x,y){
        maze[y][x]=0;
        let dirs=[[2,0],[-2,0],[0,2],[0,-2]];
        dirs.sort(()=>Math.random()-0.5);
        for(let [dx,dy] of dirs){
            let nx=x+dx, ny=y+dy;
            if(nx>0 && ny>0 && nx<cols-1 && ny<rows-1 && maze[ny][nx]===1){
                maze[y+dy/2][x+dx/2]=0;
                carve(nx,ny);
            }
        }
    }
    carve(1,1);
    player={x:1,y:1};
    exit={x:cols-2,y:rows-2};
    maze[exit.y][exit.x]=0;
}

// Ø±Ø³Ù… Ø§Ù„Ù…ØªØ§Ù‡Ø©
function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let y=0;y<rows;y++){
        for(let x=0;x<cols;x++){
            if(maze[y][x]===1){ ctx.fillStyle="white"; ctx.fillRect(x*size,y*size,size,size); }
        }
    }
    ctx.fillStyle="lime"; ctx.fillRect(exit.x*size,exit.y*size,size,size);
    ctx.fillStyle="cyan"; ctx.fillRect(player.x*size,player.y*size,size,size);
}

// Ø¥Ø´Ø¹Ø§Ø¹ Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø±Ø­Ù„Ø©
function showLevelEffect(){
    let radius=0, maxRadius=size*4, color="cyan";
    const interval=setInterval(()=>{
        draw();
        ctx.beginPath();
        ctx.arc(player.x*size+size/2, player.y*size+size/2, radius,0,Math.PI*2);
        ctx.fillStyle=`rgba(0,255,255,${1-radius/maxRadius})`;
        ctx.fill();
        radius+=3;
        if(radius>maxRadius){ clearInterval(interval); draw(); }
    },20);
}

// Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø±Ø§Ø­Ù„
function flashyTransition(callback){
    transitionSound.currentTime=0; transitionSound.play();
    let frame=0, maxFrames=20;
    const interval=setInterval(()=>{
        draw();
        const radius=(frame*10);
        ctx.beginPath();
        ctx.arc(player.x*size+size/2, player.y*size+size/2, radius,0,Math.PI*2);
        ctx.strokeStyle=`rgba(0,255,255,${1-frame/maxFrames})`;
        ctx.lineWidth=2;
        ctx.stroke();
        frame++;
        if(frame>maxFrames){ clearInterval(interval); draw(); callback(); }
    },30);
}

// Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
function nextLevel(){
    level++;
    if(level>best){ best=level; localStorage.setItem("bestLevel",best); document.getElementById("best").innerText=best; }
    document.getElementById("level").innerText=level;
    saveProgress();
    flashyTransition(startLevel);
}

// Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
function move(dx,dy){
    let nx=player.x+dx, ny=player.y+dy;
    if(nx>=0 && ny>=0 && nx<cols && ny<rows){
        if(maze[ny][nx]===0){ player.x=nx; player.y=ny; }
    }
    if(player.x===exit.x && player.y===exit.y){ nextLevel(); }
    draw();
}

// ØªØ­ÙƒÙ… Ø¨Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
document.addEventListener("keydown",e=>{
    if(document.getElementById("gameOver").style.display==="flex") return;
    if(e.key==="ArrowUp") move(0,-1);
    if(e.key==="ArrowDown") move(0,1);
    if(e.key==="ArrowLeft") move(-1,0);
    if(e.key==="ArrowRight") move(1,0);
});

// ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ù‡ÙˆØ§ØªÙ
let touchStartX=0, touchStartY=0;
canvas.addEventListener("touchstart",e=>{ const t=e.touches[0]; touchStartX=t.clientX; touchStartY=t.clientY; }, {passive:true});
canvas.addEventListener("touchend",e=>{
    const t=e.changedTouches[0];
    const dx=t.clientX-touchStartX, dy=t.clientY-touchStartY;
    if(Math.abs(dx)>Math.abs(dy)){ if(dx>30) move(1,0); else if(dx<-30) move(-1,0); }
    else{ if(dy>30) move(0,1); else if(dy<-30) move(0,-1); }
}, {passive:true});

// Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ­Ø©
function resizeCanvas(){
    const minSide=Math.min(window.innerWidth, window.innerHeight-100);
    canvas.width=minSide; canvas.height=minSide;
    if(cols) size=canvas.width/cols;
    draw();
}
window.addEventListener("resize", resizeCanvas);

// Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø©
function startLevel(){
    generateMaze();
    resizeCanvas();
    showLevelEffect();
    timeLeft=Math.max(20, 30+Math.floor(level/2)*2);
    document.getElementById("time").innerText=timeLeft;
    clearInterval(timer);
    timer=setInterval(()=>{
        timeLeft--; document.getElementById("time").innerText=timeLeft;
        if(timeLeft<=0) gameOver();
    },1000);
}

// Game Over
function gameOver(){
    clearInterval(timer);
    document.getElementById("gameOver").style.display="flex";
    document.getElementById("finalLevel").innerText="ÙˆØµÙ„Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­Ù„Ø© "+level;
}

// Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
function retry(){
    document.getElementById("gameOver").style.display="none";
    startLevel();
}

// Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
function resetGame(){
    localStorage.removeItem("currentLevel");
    level=1;
    document.getElementById("level").innerText=level;
    document.getElementById("gameOver").style.display="none";
    startLevel();
}

startLevel();
</script>
</body>
</html>